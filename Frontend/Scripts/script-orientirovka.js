const question = [
    {
     header:
     "Я ТЫ И НИКТО. Шведская сказка.",
        text: 
        `      В одной деревне жил (поп),такой 
        скупой и жадный, что никто не хотел 
        идти к нему в (работники).
             Однажды ехал он куда-то по своему делу 
        и (по дороге) повстречал (батрака).
         Батрак знал, что поп этот очень (жаден),
        и решил проучить его. Он остановил (попа) 
        и (спросил), не нужен ли ему работник.
             - Да, - ответил поп, -
        (нужен). А сколько тебе (платить)?
             - (Пять крон), - сказал
        батрак.
             - Ладно, это мне подходит,
        - сказал поп и дал ему задаток.
             Потом спросил:
             - А как же тебя зовут?
             - Меня зовут (Ты), - ответил
        батрак.
             Поп поехал дальше, а
        батрак побрел (напрямик) через
        лес. Он вывернул свою (одежду) и
        опять (попался) попу навстречу.
             Он снова остановил попа и
        спросил, не нужен ли ему
        работник.
             - Да, нужен, - ответил
        поп. - А сколько тебе платить?
             - Пять крон, - сказал
        батрак.
             - Ладно, это мне подходит,
        - сказал поп и дал ему задаток.
             Потом спросил:
             - А как же тебя зовут?
             - Меня зовут (Я), - ответил
        батрак.
             Обогнав попа, он в (третий)
        раз (попался) ему навстречу и
        спросил, не нужен ли ему
        работник.
             - Да, - сказал поп, -
        нужен. Я уже нашел (двоих), но и
        тебя, пожалуй, тоже возьму. Как
        тебя зовут?
             - Меня зовут (Никто), -
        ответил (батрак).
             Поп дал ему задаток и,
        очень (довольный) тем, что так
        дешево нанял сразу трех
        работников, поехал домой. Дома
        он сказал (жене):
             - Ну, теперь-то уж нам не
        придется (жаловаться), что некому
        у нас работать. Я нанял сразу
        троих! Теперь (работа) пойдет
        так: на гумне - Ты и Я, а на
        дворе - Никто.
             - Ну, - отвечала (жена), -
        значит, все остается как было?
        Ведь когда ты и я (на гумне), то
        на дворе, конечно, - никто!"
        `,
        questions: [
            "Кто в деревне был скупой и жадный?",
            "Кого встретил поп по дороге?",
            "Как в третий раз назвал себя батрак?",
        ],
        correct: [
            "поп",
            "батрака",
            "Никто",
        ], 
    },
    {
     header: "НЕ МОЕ ДЕЛО!  Китайская сказка",
     text:
     `     Жил в нашей деревне один
     крестьянин. Такой он был
     удивительный (человек), что если
     ему сказать: у соседа дом
     горит, он ответит:
          - А я при чем? О чужих
     делах даже небо не заботится!
     Это (не мое дело).
          Так и прозвали его у нас:
     Не-мое-дело.
          Однажды Не-мое-дело купил
     в городе (мешок соевых бобов).
     Взвалил он его на (плечо) и понес
     домой... А того и не заметил,
     что в мешке была (дыра). Вот он
     идет, а (бобы) один за другим
     сыплются (на землю).
          Вскоре с ним поравнялся
     (сосед), который тоже возвращался
     с базара. Посмотрел он, как
     (бобы) из мешка сыплются, и
     спросил Не-мое-дело:
          - Если у другого случилась
     (беда), сказать ему или не
     сказать?
          - Чужие дела никого не
     касаются, - (проворчал)
     Не-мое-дело.
          Сосед замолчал.
          (Прошли еще немного). Бобы
     все сыплются и сыплются. (Мешок)
     наполовину опустел. (Сосед) опять
     спрашивает:
          - Ну а если можно помочь
     чужой беде, тогда как?
          - Да никак! - (отвечает)
     Не-мое-дело. - Тебе-то какая от
     этого выгода? Никогда не
     путайся в чужие дела.
         (Дошли до деревни). Тут
     только заметил Не-мое-дело, что
     почти все (бобы) высыпались из
     мешка. Очень он рассердиля.
          - Что же ты, черепаший
     сын, не сказал мне ничего?
           Сосед отвечает:
        - Так ведь ты, Не-мое-дело,
     сам мне сказал, что это не мое
     дело!"
     `,
     questions: [
          "Что купил Не-мое-дело в городе?",
          "Что было в мешке?",
          "Когда заметил крестьянин что бобы все высыпались?",

      ],
      correct: [
          "мешок соевых бобов",
          "дыра",
          "Дошли до деревни",
      ], 
    },
    {
     header: "ТРИ УРОЖАЯ С ОДНОГО ДЕРЕВА. Афганская сказка",
     text:
     `     Как-то раз ехал падишах со
     своей свитой (по полю). Вдруг
     видит, что какой-то дряхлый
     старик сажает (оливковое) дерево.
     Удивился падишах, подъехал к
     старику и спросил его:
          - Седобородый, чем это ты
     занимаешься в жаркий (полдень)?
     Тебе давно пора отдыхать, а ты
     все трудишься! Да и (потом), сам
     аллах не знает, доживешь ли ты
     до того дня, когда это (дерево)
     начнет плодоносить.
          - О всемогущий (повелитель)!
     Ведь так заведено в этом мире,
     что один (сажает) деревья, а
     плоды достаются другому. Но я
     все же надеюсь дожить до того
     дня, когда дерево принесет
     плоды, - (с улыбкой) добавил
     (старик).
          Падишаху (понравился) такой
     ответ, и он бросил старику
     кошелек с монетами.
          - Вот видишь! - засмеялся
     старик. - (Дерево) уже начало
     плодоносить!
          Падишах засмеялся и бросил
     (старику) еще один кошелек.
          - О великий падишах!
     (Обрати внимание), все деревья
     приносят плоды только (один раз)
     в году, а мое - два раза!
          Эта (шутка) еще больше
     (понравилась) падишаху. Он бросил
     (третий кошелек) и сказал своим
     спутникам:
          - (Поехали, друзья)! А то мы
     совсем (разоримся), если еще
     постоим рядом с этим стариком."
     `,
     questions: [
          "Какое дерево сажал старик?",
          "В какое время сажал старик дерево?",
          "Чего испугался падишах, если еще постоит рядом со стариком?",
      ],
      correct: [
          "оливковое",
          "полдень",
          "разоримся",
      ], 
    }
]

// const textContainer = document.querySelector('#text-container');
// const listContainer = document.querySelector('#list');

// let questionIndex = 2; // текущий вопрос

// clearPage();
// showQuestion();

// function clearPage(){
//     textContainer.innerHTML = '';
//     listContainer.innerHTML = '';
// }

// function showQuestion(){
//      console.log('showQuestion');
 
//      // Заголовок и текст
//      const headerTemplate = `
//      <h1 class="title">%title%</h1>
//      <p class="text">%text%</p>
//      `;
//      const title = headerTemplate.replace('%title%', question[questionIndex]['header'])
//                                  .replace('%text%', question[questionIndex]['text']);
//      textContainer.innerHTML = title;

//      // Вопросы
//      let questionNumber = 1;
//      for (questionText of question[questionIndex]['questions']) {
//          const questionTemplate = 
//           `<li>
//                <span>%question%</span>
//           </li>`;
 
//          const questionHTML = questionTemplate.replace('%question%', questionText);
 
//          listContainer.innerHTML += questionHTML;
//          questionNumber++;
//      }
// }

// // Таймер
// let timer = document.getElementById('timer');
// let startTime;
// let elapsedTime = 0;
// let timerInterval;

// function startTimer() {
//   startTime = Date.now();
//   timerInterval = setInterval(updateTimer, 10);
// }

// function updateTimer() {
//   elapsedTime = Date.now() - startTime;
//   timer.innerHTML = millisecondsToTime(elapsedTime);
// }

// function stopTimer() {
//   clearInterval(timerInterval);
// }

// function millisecondsToTime(ms) {
//   let seconds = Math.floor(ms / 1000);
//   let minutes = Math.floor(seconds / 60);
//   let hours = Math.floor(minutes / 60);

//   seconds = seconds % 60;
//   minutes = minutes % 60;
//   hours = hours % 24;

//   return `Время: ${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
// }

// startTimer();

// // Вычисляем эффективность
// function calculateEfficiency(trainingTime, averageResponseTime, correctAnswers) {
//      const efficiency = (trainingTime / averageResponseTime) * correctAnswers;
//      return efficiency.toFixed(2);
// }
   
// // Показываем результаты в модальном окне
// function showResults(trainingTime, averageResponseTime, correctAnswers, efficiency) {
//      document.getElementById('training-time').innerHTML = trainingTime;
//      document.getElementById('average-response-time').innerHTML = averageResponseTime;
//      document.getElementById('correct-answers').innerHTML = correctAnswers;
//      document.getElementById('efficiency').innerHTML = efficiency;
   
//      document.getElementById('result-modal').style.display = 'block';
// }

// // Основной код

// // const text = textContainer.innerHTML;

// const highlightedText = textContainer.innerHTML.replace(/\((.*?)\)/g, '<span style="color: green; cursor: pointer;">$1</span>');

// textContainer.innerHTML = highlightedText;
 
// const spans = document.querySelectorAll('span');
// let redCount = 0;

// spans.forEach(span => {
//      let clicked = false;
//      span.addEventListener('click', () => {
//        if (redCount < 3) {
//          if (!clicked) {
//            span.style.color = 'red';
//            redCount++;
//            clicked = true;
//          } else {
//            span.style.color = 'green';
//            redCount--;
//            clicked = false;
//          }
//        }
   
//        const selectedWords = getSelectedWords();
//        document.getElementById('marked-words').innerHTML = `Отмечено ${selectedWords.count} из 3`;
   
//        if (redCount === 3) {
//          stopTimer();
   
//          const correctWords = question[questionIndex]['correct'];
//          let score = 0;
   
//          for (let i = 0; i < selectedWords.words.length; i++) {
//            if (correctWords.includes(selectedWords.words[i])) {
//              score++;
//            }
//          }
   
//          const percentage = (score / 3) * 100;
//          const trainingTime = timer.innerHTML;
//          const averageResponseTime = elapsedTime / 3;
//          const efficiency = calculateEfficiency(trainingTime, averageResponseTime, percentage);
   
//          showResults(trainingTime, averageResponseTime, percentage, efficiency);
//        }
//        console.log(`Red count: ${redCount}`);
//      });
// });

// function getSelectedWords() {
//      const selectedWords = [];
//      let count = 0;
//      spans.forEach(span => {
//        if (span.style.color === 'red') {
//          selectedWords.push(span.textContent);
//          count++;
//        }
//      });
//      return { words: selectedWords, count: count };
// }



const headerElement = document.getElementById("header");
const textElement = document.getElementById("text");
const questionsElement = document.getElementById("questions");
const markedWordsElement = document.getElementById("marked-words");

const modal = document.getElementById("modal");
const result = document.getElementById("result");
const efficiency = document.getElementById("efficiency");
const time = document.getElementById("time");
const avgTime = document.getElementById("avg-time");
const grade = document.getElementById("grade");
const timer = document.getElementById("timer");
const closeModalButton = document.getElementById("close-modal");

let QuestionIndex = 0;
let markedCount = 0;

let seconds = 0;
let seconds2 = seconds;
let minutes = 0;
let hours = 0;
let interval;

function showQuestion() {
     const { header, text, questions, correct } = question[QuestionIndex];

     headerElement.textContent = header;
     textElement.innerHTML = text.replace(/\((.*?)\)/g, '<span style="color: green; cursor: pointer;">$1</span>');

     questionsElement.innerHTML = "";
     questions.forEach((question, index) => {
          const li = document.createElement("li");
          li.textContent = question;
          questionsElement.appendChild(li);
     });
}

function startTimer() {
     interval = setInterval(() => {
          seconds++;
          seconds2++;
          if (seconds === 60) {
               seconds = 0;
               minutes++;
          }
          if (minutes === 60) {
               minutes = 0;
               hours++;
          }
          timer.textContent = `Время: ${hours}:${minutes.toString().padStart(2, 0)}:${seconds.toString().padStart(2, 0)}`;
     }, 1000);
}
   
function stopTimer() {
     clearInterval(interval);
}

showQuestion();
startTimer();

const spans = document.querySelectorAll('span');
let redCount = 0;

spans.forEach(span => {
     let clicked = false;
     span.addEventListener('click', () => {
       if (redCount < 3) {
         if (!clicked) {
           span.style.color = 'red';
           redCount++;
           clicked = true;
         } else {
           span.style.color = 'green';
           redCount--;
           clicked = false;
         }
       }
   
       const selectedWords = getSelectedWords();
       document.getElementById('marked-words').innerHTML = `Отмечено ${selectedWords.count} из 3`;
   
       if (redCount === 3) {
         stopTimer();
   
         const correctWords = question[QuestionIndex]['correct'];
         let score = 0;
   
         for (let i = 0; i < selectedWords.words.length; i++) {
               if (correctWords.includes(selectedWords.words[i])) {
                    score++;
               }
          }
          console.log(score);
   
     //     const percentage = (score / 3) * 100;
     //     const trainingTime = timer.innerHTML;
     //     const averageResponseTime = elapsedTime / 3;
     //     const efficiency = calculateEfficiency(trainingTime, averageResponseTime, percentage);
   
     //     showResults(trainingTime, averageResponseTime, percentage, efficiency);

     modal.style.visibility = "visible";
     result.textContent = `Правильных ответов(%): ${Math.round((score / question.length) * 100)}%`;
     time.textContent = `Время тренинга: ${hours}:${minutes.toString().padStart(2, 0)}:${seconds.toString().padStart(2, 0)}`;
     avgTime.textContent = `Среднее время ответа(сек): ${seconds2 / question.length}`;
     efficiency.textContent = `Эффективность: ${Math.round((score / question.length) * 100) / (seconds2 / question.length)}`;
     calculateGrade(score);
       }
       console.log(`Red count: ${redCount}`);
     });
});

function calculateGrade(score) {
     const percentage = (score / question.length) * 100;
     if (percentage >= 90) {
       grade.textContent = "Оценка: Отлично";
     } else if (percentage >= 70) {
       grade.textContent = "Оценка: Хорошо";
     } else if (percentage >= 50) {
       grade.textContent = "Оценка: Удовлетворительно";
     } else {
       grade.textContent = "Оценка: Неудовлетворительно";
     }
 }
 
 closeModalButton.addEventListener("click", () => {
   modal.style.visibility = "hidden";
   window.location.reload();
   window.location.href = "../Pages/menu.html";
 });

function getSelectedWords() {
     const selectedWords = [];
     let count = 0;
     spans.forEach(span => {
       if (span.style.color === 'red') {
         selectedWords.push(span.textContent);
         count++;
       }
     });
     return { words: selectedWords, count: count };
}